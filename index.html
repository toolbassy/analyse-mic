<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/x-icon" href="https://oiltest.report/assets/favicon%20orange-eb36b919657e9e014dd9f7e3a146b15c59d64b9ee43db4d88d05017fe4168f86.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minerclient</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    :root{
      --bg:#ffffff; --text:#111827; --muted:#6b7280;
      --border:#e5e7eb; --panel:#ffffff;
      --shadow:0 10px 30px rgba(15,23,42,.06); --radius:14px;
    }
    html, body { height:100%; margin:0; padding:0; }
    body{
      font:15px/1.65 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans";
      color:var(--text); background:var(--bg);
      display:flex; justify-content:center; align-items:flex-start;
    }
    .container{
      width:100%;
      max-width:1080px;
      padding:20px;
      box-sizing:border-box;
    }
    header{display:flex;align-items:center;gap:14px;margin-bottom:12px}
    .notice{
      background:var(--panel); border:1px solid var(--border);
      border-radius:var(--radius); box-shadow:var(--shadow);
      padding:18px; margin-bottom:18px;
    }
    .notice p{margin:0 0 10px}
    .notice a{color:inherit; text-decoration:none}
    .viewer-wrap{
      display:none;
      justify-content:center;
    }
    .viewer{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      width:100%;
      padding:20px;
    }
    .controls{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:10px;
      margin-bottom:15px;
      padding:10px;
      background:#f9fafb;
      border-radius:8px;
      flex-wrap:wrap;
    }
    .controls input{
      padding:8px 12px;
      border:1px solid var(--border);
      border-radius:6px;
      font-size:14px;
      width:60px;
      text-align:center;
    }
    .controls button{
      padding:8px 16px;
      background:#111827;
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-size:14px;
      white-space:nowrap;
    }
    .controls button:hover{
      background:#374151;
    }
    .controls button:disabled{
      background:#d1d5db;
      cursor:not-allowed;
    }
    .controls span{
      font-weight:500;
      font-size:14px;
    }
    @media (max-width: 480px) {
      .controls{
        gap:8px;
        padding:8px;
      }
      .controls input{
        width:50px;
        padding:6px 8px;
        font-size:13px;
      }
      .controls button{
        padding:6px 12px;
        font-size:13px;
      }
      .controls span{
        font-size:13px;
      }
    }
    #pdfContainer{
      width:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:20px;
    }
    .pdf-page{
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
      max-width:100%;
    }
    .loading{
      text-align:center;
      padding:40px;
      color:var(--muted);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="https://oiltest.report/images/micgsm-logo-3-web-bw.png" alt="logo" style="width:100px">
    </header>
    <section class="notice">
      <p>Пожалуйста, удостоверьтесь, что оригинальный протокол, представленный на этом сайте, идентичен тому, что у Вас в руках.</p>
      <p>Также проверьте, что страница открылась именно в домене:
        <a href="https://oiltest.report">"https://oiltest-report.ru"</a>.
        Любой другой адрес и протокол будут считаться неоригинальными.</p>
    </section>
    <div id="viewerWrap" class="viewer-wrap">
      <section class="viewer">
        <div class="controls">
          <div style="display:flex;align-items:center;gap:8px;">
            <span>Страница:</span>
            <input type="number" id="pageInput" min="1" value="1">
            <span>/ <span id="pageCount">-</span></span>
          </div>
          <button id="goToPage">Перейти</button>
        </div>
        <div id="pdfContainer">
          <div class="loading">Загрузка...</div>
        </div>
      </section>
    </div>
  </div>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    const PDFS = {
      "a7f3k9m2p5x8q4w6e1r9t2y5u7i3o8p1l6k4j9h2g5f8d3s7a1z9x4c6v2b8n5m1q3w7e9r4t6y1u8i3o5p2": "GPA-1.pdf",
      "z3x8c5v1b6n4m9q2w7e4r1t6y9u3i8o5p2l1k7j4h9g6f3d8s5a2z7x1c4v9b6n3m8q5w2e7r4t1y6u9i3o8p5": "GPA-2.pdf",
      "m8n5b2v9c6x1z4a7s3d6f9g2h5j8k1l4p7o3i6u9y2t5r8e1w4q7m3n6b9v2c5x8z1a4s7d3f6g9h2j5k8l1p4": "GPA-3.pdf"
    };

    const params = new URLSearchParams(location.search);
    const key = params.get("token");
    
    if (key && PDFS[key]) {
      document.getElementById("viewerWrap").style.display = "flex";
      
      let pdfDoc = null;
      let currentPage = 1;
      const container = document.getElementById("pdfContainer");
      const pageInput = document.getElementById("pageInput");
      const pageCountSpan = document.getElementById("pageCount");
      const goToBtn = document.getElementById("goToPage");

      pdfjsLib.getDocument(PDFS[key]).promise.then(pdf => {
        pdfDoc = pdf;
        pageCountSpan.textContent = pdf.numPages;
        pageInput.max = pdf.numPages;
        container.innerHTML = '';
        renderAllPages();
      }).catch(err => {
        container.innerHTML = '<p style="color:red">Ошибка загрузки PDF: ' + err.message + '</p>';
      });

      function renderAllPages() {
        for (let i = 1; i <= pdfDoc.numPages; i++) {
          renderPage(i);
        }
      }

      function renderPage(num) {
        pdfDoc.getPage(num).then(page => {
          const scale = (window.devicePixelRatio || 1) * 2;
          const viewport = page.getViewport({scale: 1.5});
          const canvas = document.createElement('canvas');
          canvas.className = 'pdf-page';
          const context = canvas.getContext('2d');
          
          // Контейнер енін тексереміз
          const containerWidth = container.offsetWidth;
          const pageWidth = viewport.width;
          const scaleToFit = containerWidth < pageWidth ? containerWidth / pageWidth : 1;
          
          canvas.height = viewport.height * scale;
          canvas.width = viewport.width * scale;
          canvas.style.width = (viewport.width * scaleToFit) + 'px';
          canvas.style.height = (viewport.height * scaleToFit) + 'px';

          const renderContext = {
            canvasContext: context,
            viewport: viewport,
            transform: [scale, 0, 0, scale, 0, 0]
          };

          container.appendChild(canvas);
          page.render(renderContext);
        });
      }

      goToBtn.addEventListener('click', () => {
        const pageNum = parseInt(pageInput.value);
        if (pdfDoc && pageNum >= 1 && pageNum <= pdfDoc.numPages) {
          currentPage = pageNum;
          scrollToPage(currentPage);
        }
      });

      pageInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          goToBtn.click();
        }
      });

      function scrollToPage(pageNum) {
        const canvases = container.querySelectorAll('canvas');
        if (canvases[pageNum - 1]) {
          canvases[pageNum - 1].scrollIntoView({behavior: 'smooth', block: 'start'});
        }
      }

      let observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const canvases = Array.from(container.querySelectorAll('canvas'));
            const pageIndex = canvases.indexOf(entry.target);
            if (pageIndex !== -1) {
              currentPage = pageIndex + 1;
              pageInput.value = currentPage;
            }
          }
        });
      }, {threshold: 0.5});

      setTimeout(() => {
        container.querySelectorAll('canvas').forEach(canvas => {
          observer.observe(canvas);
        });
      }, 1000);
    }
  </script>
</body>
</html>
